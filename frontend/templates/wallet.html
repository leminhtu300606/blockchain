{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-8 animate-fade-in">
    <div class="flex justify-between items-end">
        <div>
            <h1 class="text-3xl font-bold">Cryptographic Wallet</h1>
            <p class="text-gray-400">Manage your digital assets and identity</p>
        </div>
        <div
            class="flex items-center space-x-2 text-xs font-bold text-blue-400 bg-blue-500/10 px-3 py-1.5 rounded-full uppercase tracking-tighter">
            <i class="fas fa-shield-alt"></i>
            <span>Secured by ECDSA</span>
        </div>
    </div>

    <!-- Wallet Dashboard -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Balance Card -->
        <div
            class="glass-panel p-8 bg-gradient-to-br from-blue-600/20 to-transparent border-t border-blue-400/30 relative overflow-hidden group">
            <div class="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-20 transition-opacity">
                <i class="fas fa-coins text-6xl"></i>
            </div>

            <p class="text-blue-300 text-xs font-bold uppercase tracking-widest mb-2 tooltip"
                data-tooltip="Funds available for spending">Available Balance</p>
            <div class="flex items-baseline space-x-3 mb-8">
                <h2 id="wallet-balance" class="text-5xl font-bold tracking-tighter">0.00</h2>
                <span class="text-xl text-gray-500 font-medium">ATH</span>
            </div>

            <div class="space-y-4">
                <div class="p-4 rounded-xl bg-black/30 border border-white/5">
                    <p class="text-[10px] text-gray-500 font-bold uppercase mb-1 tooltip"
                        data-tooltip="Your unique cryptographic identifier">Public Address</p>
                    <div class="flex items-center justify-between">
                        <p id="wallet-address" class="text-xs font-mono text-gray-400 truncate mr-4">Not Connected</p>
                        <button onclick="BlockchainUtils.copyToClipboard('wallet-address')"
                            class="text-blue-400 hover:text-blue-300">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Identity Management -->
        <div class="glass-panel p-8 space-y-6">
            <h3 class="text-lg font-bold">Key Management</h3>

            <div class="space-y-4">
                <button onclick="generateNewWallet()"
                    class="w-full glow-button py-3 rounded-xl text-sm font-bold text-white flex items-center justify-center space-x-2">
                    <i class="fas fa-plus-circle"></i>
                    <span>Generate New Identity</span>
                </button>

                <p class="text-[10px] text-gray-500 text-center uppercase font-bold tracking-widest">or</p>

                <div class="relative">
                    <input type="password" id="import-key" placeholder="Enter Private Key to Import"
                        class="w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-sm font-mono focus:outline-none focus:border-blue-500 transition-colors">
                    <button onclick="importWallet()"
                        class="absolute right-2 top-2 px-3 py-1 bg-gray-800 rounded-lg text-[10px] font-bold uppercase hover:bg-gray-700">Import</button>
                </div>
            </div>

            <div id="key-display" class="hidden p-4 rounded-xl bg-yellow-500/5 border border-yellow-500/20 space-y-3">
                <div class="flex items-center space-x-2 text-yellow-500">
                    <i class="fas fa-exclamation-triangle text-xs"></i>
                    <p class="text-[10px] font-bold uppercase">Back up your Private Key!</p>
                </div>
                <p class="text-[10px] text-gray-400 leading-relaxed">This key grants total control over your funds.
                    Never share it with anyone.</p>
                <div class="p-2 bg-black/40 rounded border border-white/5 flex items-center justify-between">
                    <code id="private-key-val"
                        class="text-[10px] font-mono text-yellow-200/70 truncate">************************</code>
                    <button onclick="toggleKeyVisibility()" class="text-gray-500 hover:text-gray-300">
                        <i id="key-view-icon" class="fas fa-eye text-xs"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <a href="{{ url_for('verify_transaction_page') }}"
            class="glass-panel p-6 flex items-center space-x-4 hover:bg-white/5 transition-colors">
            <div class="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center text-blue-400">
                <i class="fas fa-paper-plane"></i>
            </div>
            <div>
                <p class="font-bold text-sm">Send Assets</p>
                <p class="text-[10px] text-gray-500">Transfer ATH instantly</p>
            </div>
        </a>

        <div class="glass-panel p-6 flex items-center space-x-4 cursor-pointer hover:bg-white/5 transition-colors">
            <div class="w-10 h-10 rounded-lg bg-purple-500/10 flex items-center justify-center text-purple-400">
                <i class="fas fa-qrcode"></i>
            </div>
            <div>
                <p class="font-bold text-sm">Receive</p>
                <p class="text-[10px] text-gray-500">Show address QR</p>
            </div>
        </div>

        <div class="glass-panel p-6 flex items-center space-x-4 cursor-pointer hover:bg-white/5 transition-colors">
            <div class="w-10 h-10 rounded-lg bg-emerald-500/10 flex items-center justify-center text-emerald-400">
                <i class="fas fa-history"></i>
            </div>
            <div>
                <p class="font-bold text-sm">Activity</p>
                <p class="text-[10px] text-gray-500">Recent transactions</p>
            </div>
        </div>
    </div>
</div>

<script>
    let currentPrivateKey = null;
    let isKeyVisible = false;

    async function generateNewWallet() {
        try {
            const response = await fetch('/api/wallet/generate');
            const data = await response.json();

            document.getElementById('wallet-address').innerText = data.public_key;
            document.getElementById('private-key-val').innerText = data.private_key;
            currentPrivateKey = data.private_key;

            document.getElementById('key-display').classList.remove('hidden');

            // In a real app, we'd fetch balance for this new address
            document.getElementById('wallet-balance').innerText = "50.00"; // Mock reward for new genesis-style wallet

            alert("New identity generated! Please save your private key safely.");
        } catch (error) {
            console.error("Error generating wallet:", error);
        }
    }

    function toggleKeyVisibility() {
        const keyVal = document.getElementById('private-key-val');
        const icon = document.getElementById('key-view-icon');

        if (isKeyVisible) {
            keyVal.innerText = "************************";
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        } else {
            keyVal.innerText = currentPrivateKey;
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        }
        isKeyVisible = !isKeyVisible;
    }

    function copyToClipboard(elementId) {
        BlockchainUtils.copyToClipboard(elementId);
    }

    function importWallet() {
        const key = document.getElementById('import-key').value;
        if (key.length < 10) {
            alert("Please enter a valid private key.");
            return;
        }
        // Mock import logic
        currentPrivateKey = key;
        document.getElementById('wallet-address').innerText = "imported_address_placeholder_0x" + key.substring(0, 8);
        document.getElementById('wallet-balance').innerText = "125.40";
        alert("Wallet imported successfully!");
    }
</script>
{% endblock %}